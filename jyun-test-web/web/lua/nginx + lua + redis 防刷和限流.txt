防刷和限流的概念是：
防刷的目的是为了防止有些IP来爬去我们的网页，获取我们的价格等信息。不像普通的搜索引擎，这种爬去行为我们经过统计最高每秒300次访问，平均每秒266次访问。
由于我们的网站的页面都在CDN上，导致我们的CDN流量会定时冒尖。为了防止这种情况，打算将网页页面的访问从CDN切回主站。同时开启防刷功能，目前设置一秒200次访问即视为非法，
会阻止10分钟的访问。
限流的目的是在大促或者流量突增期间，我们的后端服务假设某个接口能够扛住的的QPS为10000，这时候同时有20000个请求进来，经过限流模块，会先放10000个请求，其余的请求会阻塞一段时间。
目前防刷模块已经经过ab的压测。
限流模块经过测试后发现，请求几乎很平均的按照限流的模式进行分布，不过会有接近1%的请求超时。因为极端情况下，一个请求总是被阻塞。（目前想到的解决方案：一个请求被阻塞多次后就放行，不再需要判断当前总请求数。）
redis部署方式：
单docker实例，由marathon负责调度，无需开启rdb和aof
风险：
 redis挂了。 处理方式：直接放行。 同时，我们的mesos能够保证redis在秒级内重启。
在限流模块的时候采用了redis的eval命令来进行原子的执行，而防刷模块没有。

下面放出代码，请各位大拿指正。close_redis的代码抄自开涛的博客中相关内容。

http://www.voidcn.com/blog/fenglvming/article/p-6109201.html
